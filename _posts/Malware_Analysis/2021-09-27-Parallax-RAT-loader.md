---
layout: post
title: Parallex RAT Loader
category: Malware_Analysis
date: 2021/09/27
---
# summary :-

the SHA-256 of the loader sample is ```5DBC5B3553CDD5DF896629CD10A614CF1C384CFAFFFB0754898EE870589F5A10```

it said [that](https://malpedia.caad.fkie.fraunhofer.de/details/win.parallax) parallax RAT is one of infamous Malwares that spread during Covid-19 pandemic, as malpedia write about it 
![malpedia about parallax](../../assets/Images/Malware_Analysis/Parallax_RAT/malpedia.PNG)

in this blog Post we are not going to dive into the main RAT pyload, instead we will focus in the loader phase and see how the loader preparing to launch the pyload in low-detected and evasive way ... as it also [said](https://twitter.com/malwrhunterteam/status/1227196799997431809) that it detected by only one Engine in "Virus Total" when it submitted for the 1st time.

# Execution Flow :-

# Techniques :-
- obfuscate static analysis by building internal structure to each stage 
- resolving API by hashing "crc32" and traverse PEB 
- anti-analyis through mixing execution of 32-bit code and 64-bit code " using heaven gates "
- dynamic stack manipulation and referencing stack vars during execution
- decode pyload from `PNG` photo 
- heavy usage of COM interfaces to do it's functionality 
- load `Ntdll.dll` from disk to evade userland AV Hooks and to confuse debugger symbolic Breakpoints
- remove hooks using Halo's Gate technique 
- anti-debugging through calling `ZwQueryInformationProcess()` either with `ProcessDebugPort => 0x07` or with `ProcessDebugObjectHandle => 0x1E`
- persistance through scheduled task using COM API masqurading `Iexplore.exe` which is ust clean copy of main loader but with added cli parameters
- evade windows defender either with `powershell.exe Set-MpPreference -ExeclusionPath` or `reg.exe add <execltion dir from defernder>` accombined with UAC bypass using `CMSTPLUA` COM interface
